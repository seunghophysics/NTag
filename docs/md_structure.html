<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NTag: Structure of the program</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">NTag
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_structure.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Structure of the program </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div class="image">
<img src="NTag.png" alt=""/>
<div class="caption">
Structure</div></div>
    <p >All neutron tagging in one event is steered by the mainframe class named <code><a class="el" href="classEventNTagManager.html">EventNTagManager</a></code>, shown as the orange box in the above figure. This class holds information that can be classified into three main categories: raw TQ hits, event variables, and the TMVA variables which are grouped by a class named <code>NTagTMVAVariables</code> and eventually fed into the neural network of the MVA tool. The class <code>NTagEventInfo</code> also has a bunch of functions that manipulate the information from the input data to form the aforementioned three categories of information that we need in our search for neutron capture candidates. All manipulation of information and variables are handled by the member functions of <code>NTagEventInfo</code>.</p>
<p ><code>NTagIO</code>shown as the blue box in the above figure is a subclass of <code>NTagEventInfo</code>, and it deals with the I/O of SK data fies. It reads the SK data files with <code>skread</code>, and uses the member functions of its base class <code>NTagEventInfo</code> to set its member variables, i.e., the raw TQ hits, event variables, and the TMVA variables. At the end of an event, <code>NTagIO</code> will fill its trees with the above member variables, and will clear all member variables to move on to the next event and loop again. At the end of the input file (EOF), the data trees will be written to an output file.</p>
<p >In detail, the data flow and the search process in one event progresses as follows:</p>
<ol type="1">
<li>An SK data file with TQREAL filled can be read by <code>NTagIO</code> via <code>skread</code>, and the SK common blocks will be filled by <code>NTagIO::ReadFile</code>, which initiates the event loop. The instructions for each event is given by <code>NTagIO::ReadMCEvent</code> in case the event is from an MC, otherwise by <code>NTagIO::ReadDataEvent</code> which again splits into either of <code>NTagIO::ReadSHEEvent</code> for SHE-triggered events or <code>NTagIO::ReadAFTEvent</code> for AFT-triggered events. Each "ReadEvent" functions include a set of "Set" functions from <code>NTagEventInfo</code>, so that event variables can be read from the SK common blocks.</li>
<li>The "ReadEvent" functions mentioned above also call <code>NTagEventInfo::AppendRawHitInfo</code> to append the raw TQ hit information from the common block <code>sktqz</code> to the private member vectors of <code>NTagEventInfo</code>: <code>vTISKZ</code>, <code>vQISKZ</code>, and <code>vCABIZ</code>. The neutron capture candidates will be searched for within these raw TQ vectors.</li>
<li>If the raw TQ vectors are set, <code>NTagEventInfo::SearchNeutronCaptures</code> will search for neutron capture candidates, looking for NHits peaks within the ToF-subtracted <code>vTISKZ</code>. Each selected peak will be saved as an instance of the class <code>NTagCandidate</code>, and <code>NTagEventInfo::vCandidates</code> is a STL vector that stores all <code>NTagCandidate</code> instances from the event.</li>
<li>Via function <code>NTagCandidate::SetNNVariables</code> The properties of the found capture candidates will be passed on to the class <code>NTagTMVAVariables</code>, which holds the variables to be fed to the neural network.</li>
<li>The class <code>NTagTMVA</code> will feed variables from <code>NTagTMVAVariables</code> to ROOT::TMVA, and the TMVA reader will evaluate the weights and the input variables to find the classifier output. The classifier output is set for each <code>NTagCandidate</code> instance.</li>
<li>Finally, <code>NTagIO</code> will fill its trees with the member variables of <code>NTagEventInfo</code>, and clear all variables for the next event. If the file hits the end, the trees will be written to an output file. </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
